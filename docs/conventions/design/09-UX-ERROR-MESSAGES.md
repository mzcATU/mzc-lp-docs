# 09. UX Error Messages

> 에러 메시지 템플릿 - 유효성 검사, API 에러, 권한 에러

---

## 핵심 규칙

```
✅ 사용자 친화적 언어 사용 (기술 용어 X)
✅ 문제 원인 + 해결 방법 제시
✅ 일관된 메시지 톤 유지
✅ 에러 유형별 적절한 UI 패턴 사용
```

---

## 1. 에러 메시지 원칙

### 1.1 좋은 에러 메시지 구성

```
┌─────────────────────────────────────────────────────────────┐
│  [무엇이 잘못됐는지] + [왜 잘못됐는지] + [어떻게 해결하는지]  │
└─────────────────────────────────────────────────────────────┘
```

| 구성 요소 | 예시 |
|----------|------|
| 무엇 | "이메일 형식이 올바르지 않습니다" |
| 왜 | "@ 기호가 필요합니다" |
| 어떻게 | "example@email.com 형식으로 입력해주세요" |

### 1.2 작성 가이드

| 권장 | 비권장 |
|------|-------|
| 명확하고 구체적으로 | 모호하게 |
| 사용자 관점에서 | 시스템 관점에서 |
| 해결책 제시 | 문제만 지적 |
| 긍정적 톤 | 비난하는 톤 |

```
✅ "비밀번호는 8자 이상이어야 합니다"
❌ "Error: Invalid password length"

✅ "파일 크기가 10MB를 초과합니다. 더 작은 파일을 선택해주세요."
❌ "File too large"

✅ "세션이 만료되었습니다. 다시 로그인해주세요."
❌ "401 Unauthorized"
```

---

## 2. 유효성 검사 에러

### 2.1 필수 필드

| 필드 | 에러 메시지 |
|------|------------|
| 이름 | "이름을 입력해주세요" |
| 이메일 | "이메일을 입력해주세요" |
| 비밀번호 | "비밀번호를 입력해주세요" |
| 전화번호 | "전화번호를 입력해주세요" |
| 일반 | "{필드명}을(를) 입력해주세요" |

### 2.2 형식 검사

| 필드 | 조건 | 에러 메시지 |
|------|------|------------|
| 이메일 | 올바른 형식 | "올바른 이메일 형식이 아닙니다 (예: name@example.com)" |
| 비밀번호 | 최소 길이 | "비밀번호는 {n}자 이상이어야 합니다" |
| 비밀번호 | 복잡성 | "비밀번호는 영문, 숫자, 특수문자를 포함해야 합니다" |
| 전화번호 | 형식 | "올바른 전화번호 형식이 아닙니다 (예: 010-1234-5678)" |
| URL | 형식 | "올바른 URL 형식이 아닙니다 (예: https://example.com)" |

### 2.3 범위 검사

| 조건 | 에러 메시지 |
|------|------------|
| 최소값 | "{필드명}은(는) {n} 이상이어야 합니다" |
| 최대값 | "{필드명}은(는) {n} 이하이어야 합니다" |
| 최소 길이 | "{필드명}은(는) {n}자 이상이어야 합니다" |
| 최대 길이 | "{필드명}은(는) {n}자 이하이어야 합니다" |
| 파일 크기 | "파일 크기는 {n}MB 이하이어야 합니다" |

### 2.4 중복 검사

| 항목 | 에러 메시지 |
|------|------------|
| 이메일 | "이미 등록된 이메일입니다" |
| 아이디 | "이미 사용 중인 아이디입니다" |
| 강의명 | "동일한 이름의 강의가 이미 존재합니다" |

### 2.5 코드 예시

```tsx
// react-hook-form + zod 스키마
const schema = z.object({
  email: z
    .string()
    .min(1, '이메일을 입력해주세요')
    .email('올바른 이메일 형식이 아닙니다'),
  password: z
    .string()
    .min(1, '비밀번호를 입력해주세요')
    .min(8, '비밀번호는 8자 이상이어야 합니다')
    .regex(
      /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])/,
      '비밀번호는 영문, 숫자, 특수문자를 포함해야 합니다'
    ),
});

// 에러 표시
{errors.email && (
  <p className="text-sm text-status-error mt-1">
    {errors.email.message}
  </p>
)}
```

---

## 3. API 에러

### 3.1 HTTP 상태별 메시지

| 상태 코드 | 유형 | 사용자 메시지 |
|----------|------|--------------|
| 400 | Bad Request | "요청을 처리할 수 없습니다. 입력 내용을 확인해주세요." |
| 401 | Unauthorized | "로그인이 필요합니다." |
| 403 | Forbidden | "접근 권한이 없습니다." |
| 404 | Not Found | "요청하신 페이지를 찾을 수 없습니다." |
| 409 | Conflict | "이미 존재하는 항목입니다." |
| 422 | Unprocessable | "입력 데이터를 처리할 수 없습니다." |
| 429 | Too Many Requests | "요청이 너무 많습니다. 잠시 후 다시 시도해주세요." |
| 500 | Server Error | "서버에 문제가 발생했습니다. 잠시 후 다시 시도해주세요." |
| 502/503/504 | Gateway/Service Unavailable | "서비스에 일시적인 문제가 있습니다. 잠시 후 다시 시도해주세요." |

### 3.2 네트워크 에러

| 상황 | 사용자 메시지 |
|------|--------------|
| 오프라인 | "인터넷 연결을 확인해주세요." |
| 타임아웃 | "요청 시간이 초과되었습니다. 다시 시도해주세요." |
| 연결 실패 | "서버에 연결할 수 없습니다. 잠시 후 다시 시도해주세요." |

### 3.3 비즈니스 로직 에러

| 상황 | 에러 메시지 |
|------|------------|
| 잔액 부족 | "잔액이 부족합니다." |
| 수강 기간 만료 | "수강 기간이 만료되었습니다." |
| 정원 초과 | "정원이 초과되었습니다." |
| 중복 신청 | "이미 신청한 강의입니다." |
| 삭제 불가 | "수강생이 있는 강의는 삭제할 수 없습니다." |

### 3.4 코드 예시

```tsx
// API 에러 핸들러
const getErrorMessage = (error: AxiosError): string => {
  if (!error.response) {
    if (error.code === 'ECONNABORTED') {
      return '요청 시간이 초과되었습니다. 다시 시도해주세요.';
    }
    return '인터넷 연결을 확인해주세요.';
  }

  const { status, data } = error.response;

  // 서버에서 제공하는 메시지가 있으면 사용
  if (data?.message) {
    return data.message;
  }

  // 기본 메시지
  switch (status) {
    case 401:
      return '로그인이 필요합니다.';
    case 403:
      return '접근 권한이 없습니다.';
    case 404:
      return '요청하신 항목을 찾을 수 없습니다.';
    case 409:
      return '이미 존재하는 항목입니다.';
    case 500:
    default:
      return '서버에 문제가 발생했습니다. 잠시 후 다시 시도해주세요.';
  }
};

// 사용
try {
  await api.createCourse(data);
  toast.success('강의가 생성되었습니다.');
} catch (error) {
  toast.error(getErrorMessage(error));
}
```

---

## 4. 권한 에러

### 4.1 역할별 권한 메시지

| 상황 | 에러 메시지 | 액션 |
|------|------------|------|
| 로그인 필요 | "로그인이 필요한 서비스입니다." | 로그인 페이지 이동 버튼 |
| 세션 만료 | "세션이 만료되었습니다. 다시 로그인해주세요." | 자동 로그아웃 + 로그인 이동 |
| 권한 부족 | "이 기능을 사용할 권한이 없습니다." | 이전 페이지로 |
| 관리자 전용 | "관리자만 접근할 수 있습니다." | 홈으로 이동 버튼 |
| 테넌트 불일치 | "접근 권한이 없는 테넌트입니다." | 대시보드로 이동 |

### 4.2 와이어프레임

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│                         🔒                                  │
│                                                             │
│              접근 권한이 없습니다.                           │
│                                                             │
│     이 페이지를 보려면 관리자 권한이 필요합니다.            │
│                                                             │
│              [ 홈으로 이동 ]  [ 문의하기 ]                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 5. 에러 UI 패턴

### 5.1 인라인 에러 (폼 필드)

```
┌─────────────────────────────────────────────────────────────┐
│  이메일 *                                                   │
│  ┌─────────────────────────────────────────────────────────┐│
│  │  invalid-email                                         │ │
│  └─────────────────────────────────────────────────────────┘│
│  ⚠️ 올바른 이메일 형식이 아닙니다 (예: name@example.com)    │
└─────────────────────────────────────────────────────────────┘
```

```tsx
<div className="space-y-1">
  <label htmlFor="email">이메일 *</label>
  <input
    id="email"
    className={cn(
      'border rounded px-3 py-2 w-full',
      error ? 'border-status-error' : 'border-border'
    )}
    aria-invalid={!!error}
    aria-describedby={error ? 'email-error' : undefined}
  />
  {error && (
    <p id="email-error" className="text-sm text-status-error flex items-center gap-1">
      <AlertCircle className="w-4 h-4" />
      {error.message}
    </p>
  )}
</div>
```

### 5.2 토스트 에러

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│                           ┌───────────────────────────────┐ │
│                           │ ❌ 저장에 실패했습니다.       │ │
│                           │    잠시 후 다시 시도해주세요. │ │
│                           └───────────────────────────────┘ │
│                                                             │
│  [페이지 콘텐츠]                                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

```tsx
// sonner 사용
toast.error('저장에 실패했습니다.', {
  description: '잠시 후 다시 시도해주세요.',
  action: {
    label: '다시 시도',
    onClick: () => handleRetry(),
  },
});
```

### 5.3 전체 페이지 에러

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│                         😢                                  │
│                                                             │
│              페이지를 찾을 수 없습니다                       │
│                                                             │
│     요청하신 페이지가 존재하지 않거나                        │
│     주소가 변경되었을 수 있습니다.                          │
│                                                             │
│              [ 홈으로 이동 ]  [ 이전 페이지 ]               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.4 섹션 에러 (재시도 가능)

```
┌─────────────────────────────────────────────────────────────┐
│  최근 활동                                                  │
│  ─────────────────────────────────────────────────────────│
│                                                             │
│                    ⚠️                                       │
│            데이터를 불러올 수 없습니다.                      │
│                                                             │
│                [ 다시 시도 ]                                │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

```tsx
{error && (
  <div className="flex flex-col items-center justify-center py-8">
    <AlertTriangle className="w-10 h-10 text-status-warning" />
    <p className="mt-2 text-text-secondary">
      데이터를 불러올 수 없습니다.
    </p>
    <Button onClick={refetch} variant="ghost" className="mt-4">
      다시 시도
    </Button>
  </div>
)}
```

---

## 6. 에러 메시지 템플릿

### 6.1 메시지 상수 파일

```tsx
// src/constants/errorMessages.ts

export const ERROR_MESSAGES = {
  // 유효성 검사
  validation: {
    required: (field: string) => `${field}을(를) 입력해주세요`,
    email: '올바른 이메일 형식이 아닙니다',
    minLength: (field: string, min: number) =>
      `${field}은(는) ${min}자 이상이어야 합니다`,
    maxLength: (field: string, max: number) =>
      `${field}은(는) ${max}자 이하이어야 합니다`,
    password: '비밀번호는 영문, 숫자, 특수문자를 포함해야 합니다',
    passwordMatch: '비밀번호가 일치하지 않습니다',
    phone: '올바른 전화번호 형식이 아닙니다',
    url: '올바른 URL 형식이 아닙니다',
  },

  // API 에러
  api: {
    network: '인터넷 연결을 확인해주세요',
    timeout: '요청 시간이 초과되었습니다. 다시 시도해주세요',
    server: '서버에 문제가 발생했습니다. 잠시 후 다시 시도해주세요',
    unknown: '알 수 없는 오류가 발생했습니다',
  },

  // 권한
  auth: {
    loginRequired: '로그인이 필요합니다',
    sessionExpired: '세션이 만료되었습니다. 다시 로그인해주세요',
    forbidden: '접근 권한이 없습니다',
    adminOnly: '관리자만 접근할 수 있습니다',
  },

  // 비즈니스 로직
  business: {
    duplicate: (item: string) => `이미 존재하는 ${item}입니다`,
    notFound: (item: string) => `${item}을(를) 찾을 수 없습니다`,
    cannotDelete: (reason: string) => `삭제할 수 없습니다: ${reason}`,
  },
} as const;
```

---

## 7. 체크리스트

### 에러 메시지 작성 시

- [ ] 사용자 친화적 언어 사용
- [ ] 문제 원인 설명
- [ ] 해결 방법 제시
- [ ] 일관된 톤 유지
- [ ] 적절한 UI 패턴 선택
- [ ] 접근성 고려 (aria-live, role="alert")

### 에러 처리 구현 시

- [ ] 유효성 검사 에러 처리
- [ ] API 에러 처리
- [ ] 네트워크 에러 처리
- [ ] 권한 에러 처리
- [ ] 재시도 옵션 제공
- [ ] 에러 로깅 (개발용)

---

## 관련 문서

- [03-UX-PATTERNS](./03-UX-PATTERNS.md) - 상태 피드백 패턴
- [08-UX-ACCESSIBILITY](./08-UX-ACCESSIBILITY.md) - 에러 접근성
- [10-UX-FORMS](./10-UX-FORMS.md) - 폼 유효성 검사
